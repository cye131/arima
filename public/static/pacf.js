$(document).ready(function(){(function(){var pathname=window.location.pathname;$("#header > .nav-item > a").each(function(){var a=$(this);var link=a.attr("href");if(link==pathname)a.addClass('active')});$("nav.sidebar > ul.nav > li.nav-item > a").each(function(){var a=$(this);var link=a.attr("href");if(link===pathname){a.addClass('active');a.closest('li').css('background-color','#e6e6f0')}})})()});function checkValidSeries(userData){var seriesCount=[];if(userData.length===0){return[]}
$.each(userData,function(k,v){if(v.data!=null)seriesCount.push(k)});return seriesCount}
function isJson(item){item=typeof item!=="string"?JSON.stringify(item):item;try{item=JSON.parse(item)}catch(e){return!1}
if(typeof item==="object"&&item!==null){return!0}
return!1}
function warnAndRedirect(){$('#main').html('<div class="jumbotron jumbotron-fluid">'+'<div class="container">'+'<h1 class="display-3"><a href="/adddata">Please add some data before you can use this tool.</a></h1>'+'</div>'+'</div>')}
function makeCheckboxes(userData,checkOrRadio){var k=0;for(i=1;i<=5;i++){if(userData[i].data==null)continue;if(checkOrRadio==='check'){$('#checkbox-div').append('<div class="custom-control custom-checkbox"><input type="checkbox" class="custom-control-input seriesInput" id="seriesInput'+i+'" data-index="'+i+'" checked><label class="custom-control-label" for="seriesInput'+i+'"><h5><span class="badge badge-secondary" style="background-color:'+(getColorArray())[i]+' ">'+userData[i].info.name+'</span></h5></label></div>')}else{$('#checkbox-div').append('<div class="custom-control custom-radio"><input type="radio" name="seriesInput" class="custom-control-input seriesInput" id="seriesInput'+i+'" data-index="'+i+'" '+(k===0?'checked':'')+'><label class="custom-control-label" for="seriesInput'+i+'"><h5><span class="badge badge-secondary" style="background-color:'+(getColorArray())[i]+' ">'+userData[i].info.name+'</span></h5></label></div>')}
k++}
return}
function getAJAX(model,logic,toScript,fromAjax,timeout){var timerStart=Date.now();$('#overlay').show();return $.ajax({url:'routerAjax.php',type:'POST',data:{model:model,logic:logic,toScript:toScript,fromAjax:fromAjax},dataType:'html',cache:!1,timeout:timeout}).fail(function(res){console.log(res);console.log('AJAX Error')}).always(function(res){$('#overlay').hide();console.log('AJAX Time: '+(Date.now()-timerStart))})}
function getUserData(uniqid){if(uniqid==null||uniqid.length<1)return;return getAJAX([],['get_json_storage'],['userData'],{'uniqid':uniqid},10000)}
function updateSidebar(userData){for(i=1;i<=5;i++){if(userData[i]!=null&&userData[i].data!=null){$('#ser'+i).find('span').removeClass('badge-warning').removeClass('badge-danger').addClass('badge-success').text(userData[i].info.name)}else{$('#ser'+i).find('span').removeClass('badge-warning').removeClass('badge-success').addClass('badge-danger').text('Empty')}}}
function getCookieValue(a){var b=document.cookie.match('(^|;)\\s*'+a+'\\s*=\\s*([^;]+)');return b?b.pop():''}
function getColorArray(){return["#7cb5ec","#434348","#90ed7d","#f7a35c","#8085e9","#f15c80","#e4d354","#2b908f","#f45b5b","#91e8e1"]}
function arrayColumn(array,columnName){return array.map(function(value,index){return value[columnName]})};$(document).ready(function(){(function(){var uniqid=getCookieValue('uniqid');if(uniqid==null){warnAndRedirect();return}
var ajaxGetUserData=getUserData(uniqid);ajaxGetUserData.done(function(res){userData=JSON.parse(res).userData;updateSidebar(userData);$('#ser-list').data('userData',userData);if(checkValidSeries(userData).length===0){warnAndRedirect();return}
makeCheckboxes(userData,'radio');getACF()})})();$('#graph-options').on('change','input,select',function(){console.log('s');getACF()});$('#tsChart').on('click','button.lag',function(){$(this).addClass('active');$(this).siblings().removeClass('active');$('#tsChart').highcharts().update({xAxis:{max:$(this).data('xmax')}})});$('#tsChart').on('click','button.lag-hl',function(){if($(this).hasClass('btn-outline-primary')){$(this).removeClass('btn-outline-primary').addClass('btn-primary');$('#tsChart').highcharts().series[2].show()}else if($(this).hasClass('btn-primary')){$(this).removeClass('btn-primary').addClass('btn-outline-primary');$('#tsChart').highcharts().series[2].hide()}})});function getACF(){var userData=$('#ser-list').data().userData;var serInput=$('#graph-options input[type="radio"]:checked');if(serInput.length!==1)return;var serIndex=serInput.data('index');var serName=userData[serIndex].info.name;var transformInput=$('#graph-options #ser-transformation > option:selected');if(transformInput.length!==1)return;var transformIndex=transformInput.data('index');console.log(transformIndex);console.log(serIndex);var data=arrayColumn(userData[serIndex].data,transformIndex);var ajaxGetACF=getAJAX([],['calculate_time_series'],['tsResult'],{'data':data,'fn':'pacf'},30000);ajaxGetACF.done(function(res){console.log(res);if(isJson(res)===!1&&res.indexOf("Singular matrix")!==-1){alert('Singular ACF matrix due to multicollinearity of data; unable to calculate PACF solution matrix.');return}
tsResult=JSON.parse(JSON.parse(res).tsResult);console.log(tsResult);drawACF(tsResult,serName,serIndex);tableACF(tsResult)})}
function drawACF(data,name,serIndex){var dataACFVal=[];var dataACFSE=[];var dataACFSig=[];$.each(data,function(i,row){dataACFVal.push({x:row.lag,y:row.pacf});dataACFSE.push({x:row.lag,low:row.pacf-1.96*row.se,high:row.pacf+1.96*row.se});if(row.pacf-1.96*row.se<0&&0<row.pacf+1.96*row.se){dataACFSig.push({x:row.lag,y:row.pacf})}});console.log(dataACFVal);console.log(dataACFSE);var options={chart:{backgroundColor:'rgba(225, 233, 240,.6)',plotBackgroundColor:'#FFFFFF',plotBorderColor:'#C0C0C0',height:500,},title:{text:'Partial Autocorrelation Function (PACF) Chart'},subtitle:{text:'<div class="btn-toolbar" role="toolbar" aria-label="Toolbar with button groups">'+'<div class="btn-group mr-2">'+'<button type="button" class="btn btn-secondary" disabled>Choose Maximum Lag:</button>'+'</div>'+'<div class="btn-group" role="group" aria-label="Choose Lag">'+'<button type="button" class="btn btn-primary lag" data-xmax="10">10</button>'+'<button type="button" class="btn btn-primary lag active" data-xmax="100">100</button>'+'<button type="button" class="btn btn-primary lag" data-xmax="1000">1000</button>'+'<button type="button" class="btn btn-primary lag" data-xmax="null"">All</button>'+'<button type="button" class="btn btn-secondary ml-2" disabled>Highlight Nonzero PACF Lags:</button>'+'<button type="button" class="btn btn-outline-primary lag-hl">&#10004;</button>'+'</div>'+'</div>',useHTML:!0},credits:{enabled:!0,text:'A maximum of 200 points can be displayed to the intensity of calculation'},legend:{enabled:!1},xAxis:{type:'linear',min:1,max:dataACFVal.length,minTickInterval:1,title:{text:'Lag'}},tooltip:{useHTML:!0,formatter:function(){return'<h6 class="text-center">PACF<sub>'+this.points[0].series.name+'</sub>(Lag='+this.points[0].x+') = <b>'+this.points[0].y.toFixed(4)+'</b></h6></br>'+'Standard Error: '+((this.points[1].point.high-this.points[0].y)/1.96).toFixed(4)+'</br>'+'95% Confidence Interval: ['+this.points[1].point.low.toFixed(4)+', '+this.points[1].point.high.toFixed(4)+']'},shared:!0},plotOptions:{series:{marker:{symbol:'diamond',radius:2}}},yAxis:{title:{text:'Autocorrelation',},floor:-1,ceiling:1,plotLines:[{color:'black',dashStyle:'longdashdot',value:0,width:2}]},series:[]};options.series.push({data:dataACFVal,name:name,type:'line',linkedTo:'ACFSE',color:getColorArray()[serIndex]},{data:dataACFSE,name:'Range',type:'arearange',linkedTo:':previous',color:Highcharts.getOptions().colors[0],fillOpacity:0.2,zIndex:0,marker:{enabled:!1}},{data:dataACFSig,name:'Significant Values',type:'scatter',color:'brightred',enableMouseTracking:!1,zIndex:2,visible:!1,marker:{radius:4}});new Highcharts.chart('tsChart',options)}
function tableACF(data){var tbl=$('#tsTable');if($.fn.DataTable.isDataTable(tbl)){tbl.DataTable().clear().destroy()}
var dataTbl=[];$.each(data,function(i,row){dataTbl.push([row.lag,row.pacf.toFixed(8),row.se.toFixed(8),'['+(row.lag-1.96*row.se).toFixed(4)+','+(row.lag+1.96*row.se).toFixed(4)+']'])});tbl.show().DataTable({data:dataTbl,iDisplayLength:15,dom:"<'row'<'col-sm-12 col-md-6'B><'col-sm-12 col-md-6'f>>"+"<'row'<'col-sm-12 px-0'tr>>"+"<'row'<'col-sm-12 col-md-5'i><'col-sm-12 col-md-7'p>>",buttons:['copy','csv','excel',],language:{search:"Search a lag value:",info:"_START_ - _END_ (_TOTAL_ total rows)"},columns:[{title:"Lag"},{title:"Partial Autocorrelation",searchable:!1},{title:'Standard Error',searchable:!1},{title:'95% Conf. Interval',searchable:!1}],columnDefs:[{}],order:[0,"asc"],pagingType:"full_numbers"});tbl.DataTable().buttons().container().appendTo('#tsTable_wrapper .col-md-6:eq(0)').children().removeClass('btn-secondary').addClass('btn-primary')}