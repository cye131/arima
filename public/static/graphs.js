$(document).ready(function(){(function(){var pathname=window.location.pathname;$("#header > .nav-item > a").each(function(){var a=$(this);var link=a.attr("href");if(link==pathname)a.addClass('active')});$("nav.sidebar > ul.nav > li.nav-item > a").each(function(){var a=$(this);var link=a.attr("href");if(link===pathname){a.addClass('active');a.closest('li').css('background-color','#e6e6f0')}})})()});function checkValidSeries(userData){var seriesCount=[];if(userData.length===0){return[]}
$.each(userData,function(k,v){if(v.data!=null)seriesCount.push(k)});return seriesCount}
function isJson(item){item=typeof item!=="string"?JSON.stringify(item):item;try{item=JSON.parse(item)}catch(e){return!1}
if(typeof item==="object"&&item!==null){return!0}
return!1}
function warnAndRedirect(){$('#main').html('<div class="jumbotron jumbotron-fluid">'+'<div class="container">'+'<h1 class="display-3"><a href="/adddata">Please add some data before you can use this tool.</a></h1>'+'</div>'+'</div>')}
function makeCheckboxes(userData,checkOrRadio){var k=0;for(i=1;i<=5;i++){if(userData[i].data==null)continue;if(checkOrRadio==='check'){$('#checkbox-div').append('<div class="custom-control custom-checkbox"><input type="checkbox" class="custom-control-input seriesInput" id="seriesInput'+i+'" data-index="'+i+'" checked><label class="custom-control-label" for="seriesInput'+i+'"><h5><span class="badge badge-secondary" style="background-color:'+(getColorArray())[i]+' ">'+userData[i].info.name+'</span></h5></label></div>')}else{$('#checkbox-div').append('<div class="custom-control custom-radio"><input type="radio" name="seriesInput" class="custom-control-input seriesInput" id="seriesInput'+i+'" data-index="'+i+'" '+(k===0?'checked':'')+'><label class="custom-control-label" for="seriesInput'+i+'"><h5><span class="badge badge-secondary" style="background-color:'+(getColorArray())[i]+' ">'+userData[i].info.name+'</span></h5></label></div>')}
k++}
return}
function getAJAX(model,logic,toScript,fromAjax,timeout){var timerStart=Date.now();$('#overlay').show();return $.ajax({url:'routerAjax.php',type:'POST',data:{model:model,logic:logic,toScript:toScript,fromAjax:fromAjax},dataType:'html',cache:!1,timeout:timeout}).fail(function(res){console.log(res);console.log('AJAX Error')}).always(function(res){$('#overlay').hide();console.log('AJAX Time: '+(Date.now()-timerStart))})}
function getUserData(uniqid){if(uniqid==null||uniqid.length<1)return;return getAJAX([],['get_json_storage'],['userData'],{'uniqid':uniqid},10000)}
function updateSidebar(userData){for(i=1;i<=5;i++){if(userData[i]!=null&&userData[i].data!=null){$('#ser'+i).find('span').removeClass('badge-warning').removeClass('badge-danger').addClass('badge-success').text(userData[i].info.name)}else{$('#ser'+i).find('span').removeClass('badge-warning').removeClass('badge-success').addClass('badge-danger').text('Empty')}}}
function getCookieValue(a){var b=document.cookie.match('(^|;)\\s*'+a+'\\s*=\\s*([^;]+)');return b?b.pop():''}
function getColorArray(){return["#7cb5ec","#434348","#90ed7d","#f7a35c","#8085e9","#f15c80","#e4d354","#2b908f","#f45b5b","#91e8e1"]}
function arrayColumn(array,columnName){return array.map(function(value,index){return value[columnName]})};$(document).ready(function(){(function(){var uniqid=getCookieValue('uniqid');if(uniqid==null){warnAndRedirect();return}
var ajaxGetUserData=getUserData(uniqid);ajaxGetUserData.done(function(res){userData=JSON.parse(res).userData;updateSidebar(userData);if(checkValidSeries(userData).length===0){warnAndRedirect();return}
var tsData=userData2tsData(userData);console.log(tsData);makeCheckboxes(userData,'check');drawTs(tsData)})})();$('#checkbox-div').on('change','input.seriesInput',function(){var name=$(this).next('label').text();var checked=$(this).is(':checked');var chart=$('#tsChart').highcharts();$.each(chart.series,function(i,ser){if(ser.name===name){if(checked===!0)ser.show();else if(checked===!1)ser.hide();return!1}})});$('#ser-transformation').change(function(){var select=$(this).val();var chart=$('#tsChart').highcharts();if(select==='pchg')chart.yAxis[0].setCompare('percent');else if(select==='val')chart.yAxis[0].setCompare('none')})});function userData2tsData(userData){var tsCount=0;var tsData=[];for(i=1;i<=5;i++){if(userData[i]==null||userData[i].data==null)continue;tsData[tsCount]={'data':[],'info':{}};tsData[tsCount].info=userData[i].info;tsData[tsCount].info.color=getColorArray()[i];for(j=0;j<userData[i].data.length;j++){tsData[tsCount].data[j]=[];tsData[tsCount].data[j][0]=new Date(userData[i].data[j][0]).getTime();tsData[tsCount].data[j][1]=parseFloat(userData[i].data[j][2])}
tsCount++}
return tsData}
function drawTs(tsData){var options={chart:{marginRight:10,backgroundColor:'rgba(225, 233, 240,.6)',plotBackgroundColor:'#FFFFFF',plotBorderColor:'#C0C0C0',height:500},title:{text:'Time Series Chart'},credits:{enabled:!1},exporting:{enabled:!1},rangeSelector:{selected:4,buttonTheme:{width:60},buttons:[{type:'month',count:1,text:'1mo'},{type:'month',count:3,text:'3mo'},{type:'ytd',count:1,text:'YTD'},{type:'year',count:1,text:'1Y'},{type:'all',text:'All'}]},xAxis:{type:'datetime',dateTimeLabelFormats:{day:"%b %e",week:"%b %e",month:"%b %Y"},gridLineWidth:1,},yAxis:{title:{text:'',},opposite:!0},plotOptions:{series:{showInNavigator:!0,dataGrouping:{units:[['day',[1]]]}},line:{turboThreshold:0},column:{stacking:'normal'}},series:[]};for(i=0;i<tsData.length;i++){options.series.push({'data':tsData[i].data,'name':tsData[i].info.name,'visible':!0,'color':tsData[i].info.color,'compare':'percent'})}
new Highcharts.stockChart('tsChart',options)}